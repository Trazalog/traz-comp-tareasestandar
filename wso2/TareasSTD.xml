<data name="TareasSTD" transports="http https local">
   <config enableOData="false" id="produccionDS">
      <property name="carbon_datasource_name">ToolsDataSource</property>
   </config>
      <query id="getTareas" useConfig="produccionDS">
         <sql>SELECT * FROM tst.tareas_std&#xd;WHERE empr_id = CAST(:empr_id as integer)&#xd;AND not eliminado</sql>
         <result outputType="json">{&#xd;    "tareas":{&#xd;       "tarea":[&#xd;           {&#xd;            "tare_id":"$tare_id",&#xd;            "nombre":"$nombre",&#xd;            "descripcion":"$descripcion",&#xd;            "duracion":"$duracion",&#xd;            "form_id":"$form_id",&#xd;            "rece_id":"$rece_id",&#xd;            "proc_id":"$proc_id"&#xd;           }&#xd;       ] &#xd;    }&#xd;}</result>
         <param name="empr_id" sqlType="STRING"/>
      </query>
      <query id="getTarea" useConfig="produccionDS">
         <sql>SELECT *&#xd;FROM tst.tareas_std&#xd;WHERE tare_id = CAST(:tare_id as integer)&#xd;AND not eliminado</sql>
         <result outputType="json">{&#xd;    "tareas":{&#xd;       "tarea":[&#xd;           {&#xd;            "tare_id":"$tare_id",&#xd;            "nombre":"$nombre",&#xd;            "descripcion":"$descripcion",&#xd;            "duracion":"$duracion",&#xd;            "form_id":"$form_id",&#xd;            "rece_id":"$rece_id",&#xd;            "proc_id":"$proc_id"&#xd;           }&#xd;       ] &#xd;    }&#xd;}</result>
         <param name="tare_id" sqlType="STRING"/>
      </query>
      <query id="setTarea" useConfig="produccionDS">
         <sql>INSERT INTO tst.tareas_std&#xd;(nombre, descripcion, duracion, form_id, rece_id, proc_id, empr_id)&#xd;VALUES(:nombre, :descripcion, :duracion, CAST(:form_id as integer), CAST(:rece_id as integer), :proc_id, CAST(:empr_id as integer));</sql>
         <param name="nombre" sqlType="STRING"/>
         <param name="descripcion" sqlType="STRING"/>
         <param name="duracion" sqlType="STRING"/>
         <param name="form_id" sqlType="STRING"/>
         <param name="rece_id" sqlType="STRING"/>
         <param name="proc_id" sqlType="STRING"/>
         <param name="empr_id" sqlType="STRING"/>
      </query>
      <query id="updateTarea" useConfig="produccionDS">
         <sql>UPDATE tst.tareas_std&#xd;SET nombre=:nombre, descripcion=:descripcion, duracion=:duracion, form_id= CAST(:form_id as integer), rece_id= CAST(:rece_id as integer), proc_id=:proc_id&#xd;WHERE tare_id=CAST(:tare_id as integer)</sql>
         <param name="nombre" sqlType="STRING"/>
         <param name="descripcion" sqlType="STRING"/>
         <param name="duracion" sqlType="STRING"/>
         <param name="form_id" sqlType="STRING"/>
         <param name="rece_id" sqlType="STRING"/>
         <param name="proc_id" sqlType="STRING"/>
         <param name="tare_id" sqlType="STRING"/>
      </query>
      <query id="deleteTarea" useConfig="produccionDS">
         <sql>UPDATE tst.tareas_std&#xd;SET eliminado = true&#xd;WHERE tare_id=CAST(:tare_id as integer)</sql>
         <param name="tare_id" sqlType="STRING"/>
      </query>
      <query id="getSubtareas" useConfig="produccionDS">
         <sql>SELECT * &#xd;FROM tst.subtareas&#xd;WHERE tare_id = CAST(:tare_id as integer)&#xd;AND not eliminado</sql>
         <result outputType="json">{&#xd;  "subtareas": {&#xd;    "subtarea": [&#xd;      {&#xd;        "suta_id": "$suta_id",&#xd;        "nombre": "$nombre",&#xd;        "descripcion": "$descripcion",&#xd;        "duracion": "$duracion",&#xd;        "tare_id": "$tare_id",&#xd;        "form_id": "$form_id"&#xd;      }&#xd;    ]&#xd;  }&#xd;}</result>
         <param name="tare_id" sqlType="STRING"/>
      </query>
      <query id="getSubtarea" useConfig="produccionDS">
         <sql>SELECT *&#xd;FROM tst.subtareas&#xd;WHERE suta_id = CAST(:suta_id as integer)</sql>
         <result outputType="json">{&#xd;  "subtareas": {&#xd;    "subtarea": [&#xd;      {&#xd;        "suta_id": "$suta_id",&#xd;        "nombre": "$nombre",&#xd;        "descripcion": "$descripcion",&#xd;        "duracion": "$duracion",&#xd;        "tare_id": "$tare_id",&#xd;        "form_id": "$form_id"&#xd;      }&#xd;    ]&#xd;  }&#xd;}&#xd;</result>
         <param name="suta_id" sqlType="STRING"/>
      </query>
      <query id="setSubtarea" useConfig="produccionDS">
         <sql>INSERT INTO tst.subtareas&#xd;(descripcion, tare_id, form_id)&#xd;VALUES(:descripcion, CAST(:tare_id as integer), CAST(:form_id as integer))</sql>
         <param name="descripcion" sqlType="STRING"/>
         <param name="tare_id" sqlType="STRING"/>
         <param name="form_id" sqlType="STRING"/>
      </query>
      <query id="updateSubtarea" useConfig="produccionDS">
         <sql>UPDATE tst.subtareas&#xd;SET nombre=:nombre, descripcion=:descripcion, tare_id=CAST(:tare_id as integer), form_id=CAST(:form_id as integer)&#xd;WHERE suta_id= CAST(:suta_id as integer)</sql>
         <param name="nombre" sqlType="STRING"/>
         <param name="descripcion" sqlType="STRING"/>
         <param name="tare_id" sqlType="STRING"/>
         <param name="form_id" sqlType="STRING"/>
         <param name="suta_id" sqlType="STRING"/>
      </query>
      <query id="deleteSubtarea" useConfig="produccionDS">
         <sql>UPDATE tst.subtareas&#xd;SET eliminado = true&#xd;WHERE suta_id= CAST(:suta_id as integer)</sql>
         <param name="suta_id" sqlType="STRING"/>
      </query>
      <query id="getPlantillas" useConfig="produccionDS">
         <sql>SELECT *&#xd;FROM tst.plantillas&#xd;WHERE empr_id = CAST(:empr_id as integer)&#xd;AND not eliminado</sql>
         <result outputType="json">{&#xd;  "plantillas": {&#xd;    "plantilla": [&#xd;      {&#xd;        "plan_id": "$plan_id",&#xd;        "nombre": "$nombre",&#xd;        "@getTareasPlantilla":$plan_id-&gt;plan_id&#xd;      }&#xd;    ]&#xd;  }&#xd;}&#xd;</result>
         <param name="empr_id" sqlType="STRING"/>
      </query>
      <query id="getPlantilla" useConfig="produccionDS">
         <sql>SELECT * &#xd;FROM tst.plantillas&#xd;WHERE plan_id = CAST(:plan_id as integer)</sql>
         <result outputType="json">{&#xd;  "plantillas": {&#xd;    "plantilla": [&#xd;      {&#xd;        "plan_id": "$plan_id",&#xd;        "nombre": "$nombre"&#xd;      }&#xd;    ]&#xd;  }&#xd;}&#xd;</result>
         <param name="plan_id" sqlType="STRING"/>
      </query>
      <query id="setPlantilla" useConfig="produccionDS">
         <sql>INSERT INTO tst.plantillas&#xd;(nombre, empr_id)&#xd;VALUES(:nombre, CAST(:empr_id as integer))</sql>
         <param name="nombre" sqlType="STRING"/>
         <param name="empr_id" sqlType="STRING"/>
      </query>
      <query id="updatePlantilla" useConfig="produccionDS">
         <sql>UPDATE tst.plantillas&#xd;SET nombre= :nombre&#xd;WHERE plan_id = CAST(:plan_id as integer)</sql>
         <param name="nombre" sqlType="STRING"/>
         <param name="plan_id" sqlType="STRING"/>
      </query>
      <query id="deletePlantilla" useConfig="produccionDS">
         <sql>UPDATE tst.plantillas&#xd;SET eliminado = true&#xd;WHERE plan_id = CAST(:plan_id as integer)</sql>
         <param name="plan_id" sqlType="STRING"/>
      </query>
      <query id="asociarPlantillaTarea" useConfig="produccionDS">
         <sql>INSERT INTO tst.rel_plantillas_tareas&#xd;(plan_id, tare_id)&#xd;VALUES(CAST(:plan_id as integer), CAST(:tare_id as integer));</sql>
         <param name="plan_id" sqlType="STRING"/>
         <param name="tare_id" sqlType="STRING"/>
      </query>
      <query id="deletePlantillaTarea" useConfig="produccionDS">
         <sql>DELETE&#xd;FROM tst.rel_plantillas_tareas&#xd;WHERE plan_id = CAST(:plan_id as integer)&#xd;AND tare_id = CAST(:tare_id as integer)</sql>
         <param name="plan_id" sqlType="STRING"/>
         <param name="tare_id" sqlType="STRING"/>
      </query>
      <query id="getTareasPlantilla" useConfig="produccionDS">
         <sql>SELECT TS.* FROM TST.REL_PLANTILLAS_TAREAS RPT , TST.TAREAS_STD TS &#xd;WHERE RPT.TARE_ID = TS.TARE_ID AND PLAN_ID = CAST(:plan_id AS INTEGER) AND NOT TS.ELIMINADO</sql>
         <result outputType="json">{&#xd;    "tareas":{&#xd;       "tarea":[&#xd;           {&#xd;            "tare_id":"$tare_id",&#xd;            "nombre":"$nombre",&#xd;            "descripcion":"$descripcion",&#xd;            "duracion":"$duracion",&#xd;            "form_id":"$form_id",&#xd;            "rece_id":"$rece_id",&#xd;            "proc_id":"$proc_id"&#xd;           }&#xd;       ] &#xd;    }&#xd;}</result>
         <param name="plan_id" sqlType="STRING"/>
      </query>
      <query id="setTareaPlanificada" useConfig="produccionDS">
         <sql>insert&#xd;	into&#xd;	tst.tareas_planificadas (nombre, fecha, hora, user_id, equi_id, case_id, tare_id)&#xd;    select :nombre, TO_DATE(:fecha,'YYYY-MM-DD'), :hora, cast(:user_id as integer), cast(:equi_id as integer), cast(:case_id as integer), CAST(:tare_id as integer) returning tapl_id;</sql>
         <result outputType="json">{&#xd;"tarea":{&#xd;"tapl_id":$tapl_id&#xd;}&#xd;}</result>
         <param name="nombre" sqlType="STRING"/>
         <param defaultValue="&quot;2300-12-31&quot;" name="fecha" optional="true" sqlType="STRING"/>
         <param name="hora" optional="true" sqlType="STRING"/>
         <param name="user_id" optional="true" sqlType="STRING"/>
         <param name="equi_id" optional="true" sqlType="STRING"/>
         <param name="case_id" optional="true" sqlType="STRING"/>
         <param name="tare_id" optional="true" sqlType="STRING"/>
      </query>
      <query id="updateTareaPlanificada" useConfig="produccionDS">
         <sql>update tst.tareas_planificadas &#xd;    set&#xd;        nombre = :nombre,&#xd;        fecha = TO_DATE(:fecha,'YYYY-MM-DD'),&#xd;        hora =:hora,&#xd;        user_id = cast(:user_id as integer),&#xd;        equi_id = cast(:equi_id as integer),&#xd;        case_id = cast(:case_id as integer),&#xd;        tare_id = cast(:tare_id as integer)&#xd;    where tapl_id = CAST(:tapl_id as integer);</sql>
         <param name="nombre" sqlType="STRING"/>
         <param name="fecha" sqlType="STRING"/>
         <param name="hora" sqlType="STRING"/>
         <param name="user_id" sqlType="STRING"/>
         <param name="equi_id" sqlType="STRING"/>
         <param name="case_id" sqlType="STRING"/>
         <param name="tare_id" sqlType="STRING"/>
         <param name="tapl_id" sqlType="STRING"/>
      </query>
      <resource method="GET" path="/tareas/{empr_id}">
         <call-query href="getTareas">
            <with-param name="empr_id" query-param="empr_id"/>
         </call-query>
      </resource>
      <resource method="GET" path="/tareas/obtener/{tare_id}">
         <call-query href="getTarea">
            <with-param name="tare_id" query-param="tare_id"/>
         </call-query>
      </resource>
      <resource method="POST" path="/tareas">
         <call-query href="setTarea">
            <with-param name="nombre" query-param="nombre"/>
            <with-param name="descripcion" query-param="descripcion"/>
            <with-param name="duracion" query-param="duracion"/>
            <with-param name="form_id" query-param="form_id"/>
            <with-param name="rece_id" query-param="rece_id"/>
            <with-param name="proc_id" query-param="proc_id"/>
            <with-param name="empr_id" query-param="empr_id"/>
         </call-query>
      </resource>
      <resource method="PUT" path="/tareas">
         <call-query href="updateTarea">
            <with-param name="nombre" query-param="nombre"/>
            <with-param name="descripcion" query-param="descripcion"/>
            <with-param name="duracion" query-param="duracion"/>
            <with-param name="form_id" query-param="form_id"/>
            <with-param name="rece_id" query-param="rece_id"/>
            <with-param name="proc_id" query-param="proc_id"/>
            <with-param name="tare_id" query-param="tare_id"/>
         </call-query>
      </resource>
      <resource method="DELETE" path="/tareas">
         <call-query href="deleteTarea">
            <with-param name="tare_id" query-param="tare_id"/>
         </call-query>
      </resource>
      <resource method="GET" path="/subtareas/{tare_id}">
         <call-query href="getSubtareas">
            <with-param name="tare_id" query-param="tare_id"/>
         </call-query>
      </resource>
      <resource method="GET" path="/subtareas/obtener/{suta_id}">
         <call-query href="getSubtarea">
            <with-param name="suta_id" query-param="suta_id"/>
         </call-query>
      </resource>
      <resource method="POST" path="/subtareas">
         <call-query href="setSubtarea">
            <with-param name="descripcion" query-param="descripcion"/>
            <with-param name="tare_id" query-param="tare_id"/>
            <with-param name="form_id" query-param="form_id"/>
         </call-query>
      </resource>
      <resource method="PUT" path="/subtareas">
         <call-query href="updateSubtarea">
            <with-param name="nombre" query-param="nombre"/>
            <with-param name="descripcion" query-param="descripcion"/>
            <with-param name="tare_id" query-param="tare_id"/>
            <with-param name="form_id" query-param="form_id"/>
            <with-param name="suta_id" query-param="suta_id"/>
         </call-query>
      </resource>
      <resource method="DELETE" path="/subtareas">
         <call-query href="deleteSubtarea">
            <with-param name="suta_id" query-param="suta_id"/>
         </call-query>
      </resource>
      <resource method="GET" path="/plantillas/{empr_id}">
         <call-query href="getPlantillas">
            <with-param name="empr_id" query-param="empr_id"/>
         </call-query>
      </resource>
      <resource method="GET" path="/plantillas/obtener/{plan_id}">
         <call-query href="getPlantilla">
            <with-param name="plan_id" query-param="plan_id"/>
         </call-query>
      </resource>
      <resource method="POST" path="/plantillas">
         <call-query href="setPlantilla">
            <with-param name="nombre" query-param="nombre"/>
            <with-param name="empr_id" query-param="empr_id"/>
         </call-query>
      </resource>
      <resource method="PUT" path="/plantillas">
         <call-query href="updatePlantilla">
            <with-param name="nombre" query-param="nombre"/>
            <with-param name="plan_id" query-param="plan_id"/>
         </call-query>
      </resource>
      <resource method="DELETE" path="/plantillas">
         <call-query href="deletePlantilla">
            <with-param name="plan_id" query-param="plan_id"/>
         </call-query>
      </resource>
      <resource method="POST" path="/plantillas/tareas">
         <call-query href="asociarPlantillaTarea">
            <with-param name="plan_id" query-param="plan_id"/>
            <with-param name="tare_id" query-param="tare_id"/>
         </call-query>
      </resource>
      <resource method="GET" path="/plantillas/tareas/{plan_id}">
         <call-query href="getTareasPlantilla">
            <with-param name="plan_id" query-param="plan_id"/>
         </call-query>
      </resource>
      <resource method="DELETE" path="/plantillas/tareas">
         <call-query href="deletePlantillaTarea">
            <with-param name="plan_id" query-param="plan_id"/>
            <with-param name="tare_id" query-param="tare_id"/>
         </call-query>
      </resource>
      <resource method="POST" path="/tarea/planificar">
         <call-query href="setTareaPlanificada">
            <with-param name="nombre" query-param="nombre"/>
            <with-param name="fecha" query-param="fecha"/>
            <with-param name="hora" query-param="hora"/>
            <with-param name="user_id" query-param="user_id"/>
            <with-param name="equi_id" query-param="equi_id"/>
            <with-param name="case_id" query-param="case_id"/>
            <with-param name="tare_id" query-param="tare_id"/>
         </call-query>
      </resource>
      <resource method="PUT" path="/tarea/planificar">
         <call-query href="updateTareaPlanificada">
            <with-param name="nombre" query-param="nombre"/>
            <with-param name="fecha" query-param="fecha"/>
            <with-param name="hora" query-param="hora"/>
            <with-param name="user_id" query-param="user_id"/>
            <with-param name="equi_id" query-param="equi_id"/>
            <with-param name="case_id" query-param="case_id"/>
            <with-param name="tare_id" query-param="tare_id"/>
            <with-param name="tapl_id" query-param="tapl_id"/>
         </call-query>
      </resource>
</data>
